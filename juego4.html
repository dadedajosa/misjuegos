<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Laberinto Perfecto con Niveles</title>
<style>
  body {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 20px;
    font-family: monospace;
    background: #eee;
  }
  #nivel {
    font-size: 24px;
    font-weight: bold;
    margin-bottom: 10px;
    color: #1e90ff;
  }
  #laberinto {
    display: grid;
    gap: 2px;
    background: #333;
    border: 4px solid #222;
  }
  .celda {
    background: #fff;
    width: 8vw;
    height: 8vw;
  }
  .pared {
    background: #222;
  }
  .jugador {
    background: #1e90ff;
  }
  .meta {
    background: #32cd32;
  }
  #mensaje {
    margin-top: 15px;
    font-size: 20px;
    font-weight: bold;
    text-align: center;
    color: #1e90ff;
    min-height: 28px;
  }
  .botones {
    display: flex;
    flex-wrap: wrap;
    width: 150px;
    justify-content: center;
    margin-top: 15px;
    gap: 5px;
  }
  .boton {
    padding: 10px;
    font-size: 18px;
    flex: 1 1 40%;
    cursor: pointer;
    background: #1e90ff;
    color: white;
    border: none;
    border-radius: 5px;
    user-select: none;
  }
</style>
</head>
<body>

<div id="nivel">Nivel: 1</div>
<div id="laberinto"></div>
<div id="mensaje">Usa las flechas o botones para moverte.</div>

<div class="botones">
  <button class="boton" onclick="moverJugador(-1,0)">‚¨ÜÔ∏è</button>
  <button class="boton" onclick="moverJugador(1,0)">‚¨áÔ∏è</button>
  <button class="boton" onclick="moverJugador(0,-1)">‚¨ÖÔ∏è</button>
  <button class="boton" onclick="moverJugador(0,1)">‚û°Ô∏è</button>
</div>

<script>
  let nivel = 1;
  const maxNivel = 20;
  let filas, columnas;
  let laberintoMapa = [];
  let jugador = { fila: 1, col: 1 };
  let meta = { fila: 0, col: 0 };
  const laberintoDiv = document.getElementById('laberinto');
  const mensaje = document.getElementById('mensaje');
  const nivelDiv = document.getElementById('nivel');

  function impar(n) { return n % 2 === 0 ? n + 1 : n; }

  function generarLaberintoDFS(filas, columnas) {
    let lab = Array.from({ length: filas }, () => Array(columnas).fill(1));
    function enRango(r,c){return r>0&&r<filas-1&&c>0&&c<columnas-1;}
    function shuffle(arr){for(let i=arr.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[arr[i],arr[j]]=[arr[j],arr[i]];}}
    function dfs(r,c){lab[r][c]=0;let dirs=[[2,0],[-2,0],[0,2],[0,-2]];shuffle(dirs);for(const [dr,dc] of dirs){const nr=r+dr,nc=c+dc;if(enRango(nr,nc)&&lab[nr][nc]===1){lab[r+dr/2][c+dc/2]=0;dfs(nr,nc);}}}
    dfs(1,1); lab[1][1]=0; if(lab[filas-2][columnas-2]===1){lab[filas-2][columnas-2]=0; if(lab[filas-3][columnas-2]===1 && lab[filas-2][columnas-3]===1){lab[filas-3][columnas-2]=0;}} return lab;
  }

  function ajustarTamanioNivel(n){let b=11+n; if(b>39)b=39; return impar(b);}

  function crearLaberinto(){
    laberintoDiv.innerHTML='';
    laberintoDiv.style.gridTemplateColumns=`repeat(${columnas},8vw)`;
    laberintoDiv.style.gridTemplateRows=`repeat(${filas},8vw)`;
    for(let i=0;i<filas;i++){
      for(let j=0;j<columnas;j++){
        const celda=document.createElement('div'); celda.classList.add('celda');
        if(laberintoMapa[i][j]===1) celda.classList.add('pared');
        if(i===jugador.fila && j===jugador.col) celda.classList.add('jugador');
        if(i===meta.fila && j===meta.col) celda.classList.add('meta');
        laberintoDiv.appendChild(celda);
      }
    }
  }

  function esCallejonSinSalida(fila,col){if(fila===meta.fila && col===meta.col) return false; const movs=[[-1,0],[1,0],[0,-1],[0,1]]; let disponibles=0; for(const [df,dc] of movs){const nf=fila+df,nc=col+dc;if(nf>=0&&nf<filas&&nc>=0&&nc<columnas){if(laberintoMapa[nf][nc]===0) disponibles++;}} return disponibles===0;}

  function moverJugador(dFila,dCol){
    const nf=jugador.fila+dFila, nc=jugador.col+dCol;
    if(nf>=0&&nf<filas&&nc>=0&&nc<columnas&&laberintoMapa[nf][nc]===0){
      jugador.fila=nf; jugador.col=nc; crearLaberinto();
      if(jugador.fila===meta.fila && jugador.col===meta.col){
        if(nivel===maxNivel){mensaje.textContent='üéâ ¬°Felicidades! ¬°Completaste todos los niveles! üéâ'; return;}
        mensaje.textContent='¬°Llegaste a la meta! Preparando siguiente nivel...';
        setTimeout(()=>{nivel++; nivelDiv.textContent=`Nivel: ${nivel}`;
          filas=columnas=ajustarTamanioNivel(nivel);
          jugador={fila:1,col:1}; meta={fila:filas-2,col:columnas-2};
          laberintoMapa=generarLaberintoDFS(filas,columnas); crearLaberinto();
          mensaje.textContent='Nuevo laberinto generado. Usa las flechas o botones para moverte.';},2000);
      }else if(esCallejonSinSalida(jugador.fila,jugador.col)){
        mensaje.textContent='üòµ ¬°Callej√≥n sin salida! Regresando al inicio...';
        setTimeout(()=>{jugador={fila:1,col:1}; crearLaberinto(); mensaje.textContent='';},1500);
      }else{mensaje.textContent='';}
    }
  }

  window.addEventListener('keydown', e=>{
    if(mensaje.textContent.includes('Felicidades') && nivel===maxNivel) return;
    switch(e.key){case 'ArrowUp':moverJugador(-1,0); e.preventDefault(); break;
                  case 'ArrowDown':moverJugador(1,0); e.preventDefault(); break;
                  case 'ArrowLeft':moverJugador(0,-1); e.preventDefault(); break;
                  case 'ArrowRight':moverJugador(0,1); e.preventDefault(); break;}
  });

  filas=columnas=ajustarTamanioNivel(nivel);
  jugador={fila:1,col:1}; meta={fila:filas-2,col:columnas-2};
  laberintoMapa=generarLaberintoDFS(filas,columnas);
  crearLaberinto();
</script>

<button onclick="window.location.href='index.html'">üîô Volver a la pantalla principal</button>
</body>
</html>